groups:
- name: sre-golden-signals
  rules:
  
  # ---------------------------------------------------------------------------
  # Availability (Error Rate)
  # ---------------------------------------------------------------------------
  - alert: HighErrorRate
    expr: |
      sum(rate(http_server_duration_count{status_code=~"5.."}[5m])) 
      / 
      sum(rate(http_server_duration_count[5m])) > 0.05
    for: 2m
    labels:
      severity: critical
      team: sre
    annotations:
      summary: "High Error Rate detected on {{ $labels.service }}"
      description: "Error rate is above 5% for more than 2 minutes. Current value: {{ $value }}"
      runbook_url: "https://github.com/org/repo/blob/main/docs/runbooks/high_error_rate.md"

  # ---------------------------------------------------------------------------
  # Latency
  # ---------------------------------------------------------------------------
  - alert: HighLatencyP95
    expr: |
      histogram_quantile(0.95, sum(rate(http_server_duration_bucket[5m])) by (le, service)) > 0.5
    for: 5m
    labels:
      severity: warning
      team: dev
    annotations:
      summary: "High Latency (P95) on {{ $labels.service }}"
      description: "P95 latency is above 500ms for 5 minutes. Current value: {{ $value }}s"

  # ---------------------------------------------------------------------------
  # Traffic (Saturation check)
  # ---------------------------------------------------------------------------
  - alert: ZeroTrafficWarning
    expr: sum(rate(http_server_duration_count[5m])) == 0
    for: 10m
    labels:
      severity: info
    annotations:
      summary: "Zero Traffic on {{ $labels.service }}"
      description: "Service has received no traffic for 10 minutes."
